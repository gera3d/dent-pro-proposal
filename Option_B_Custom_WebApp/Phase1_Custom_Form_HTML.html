<!DOCTYPE html>
<html>

<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            min-height: 100vh;
            color: #fff;
            padding: 16px;
            padding-bottom: 100px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            padding: 24px 0;
            margin-bottom: 24px;
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #fff 0%, #e0e0e0 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 4px;
        }

        .subtitle {
            color: #a1a1a6;
            font-size: 14px;
        }

        .section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #4CD964;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        label {
            display: block;
            font-size: 13px;
            color: #a1a1a6;
            margin-bottom: 6px;
            font-weight: 500;
        }

        label .required {
            color: #FF453A;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #4CD964;
            background: rgba(76, 217, 100, 0.1);
        }

        input::placeholder,
        textarea::placeholder {
            color: #666;
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23a1a1a6' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            cursor: pointer;
        }

        select option {
            background: #1a1a1a;
            color: #fff;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .checkbox-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .checkbox-item.selected {
            background: rgba(76, 217, 100, 0.15);
            border-color: #4CD964;
        }

        .checkbox-item input {
            width: auto;
            margin-right: 8px;
            accent-color: #4CD964;
        }

        .checkbox-item span {
            font-size: 13px;
            color: #e0e0e0;
        }

        /* Rating Scale Styles */
        .rating-scale {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .rating-option {
            flex: 1;
            min-width: calc(33% - 8px);
            padding: 12px 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .rating-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .rating-option.selected {
            background: rgba(76, 217, 100, 0.15);
            border-color: #4CD964;
        }

        .rating-option input {
            display: none;
        }

        .rating-option span {
            font-size: 13px;
            font-weight: 500;
        }

        /* Toggle Switch */
        .toggle-group {
            display: flex;
            gap: 16px;
        }

        .toggle-item {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .toggle-item.active {
            background: rgba(76, 217, 100, 0.15);
            border-color: #4CD964;
        }

        .toggle-switch {
            width: 48px;
            height: 28px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: #4CD964;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
        }

        .toggle-switch.active::after {
            left: 22px;
        }

        /* Severity Pills */
        .severity-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .severity-option {
            display: flex;
            align-items: center;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .severity-option:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .severity-option.selected {
            border-color: var(--severity-color);
            background: rgba(var(--severity-rgb), 0.15);
        }

        .severity-option input {
            display: none;
        }

        .severity-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 12px;
        }

        .severity-option.light .severity-dot {
            background: #30D158;
        }

        .severity-option.moderate .severity-dot {
            background: #FF9F0A;
        }

        .severity-option.heavy .severity-dot {
            background: #FF453A;
        }

        .severity-option.total .severity-dot {
            background: #8E8E93;
        }

        .severity-option.light.selected {
            --severity-color: #30D158;
            --severity-rgb: 48, 209, 88;
        }

        .severity-option.moderate.selected {
            --severity-color: #FF9F0A;
            --severity-rgb: 255, 159, 10;
        }

        .severity-option.heavy.selected {
            --severity-color: #FF453A;
            --severity-rgb: 255, 69, 58;
        }

        .severity-option.total.selected {
            --severity-color: #8E8E93;
            --severity-rgb: 142, 142, 147;
        }

        /* Submit Button */
        .submit-btn {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 16px;
            background: linear-gradient(to top, rgba(10, 10, 10, 1) 0%, rgba(10, 10, 10, 0.95) 80%, transparent 100%);
        }

        .submit-btn button {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            display: block;
            padding: 18px 32px;
            background: linear-gradient(135deg, #4CD964 0%, #30D158 100%);
            border: none;
            border-radius: 14px;
            color: #000;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .submit-btn button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(76, 217, 100, 0.3);
        }

        .submit-btn button:active {
            transform: translateY(0);
        }

        .submit-btn button:disabled {
            background: #444;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Success Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: #1a1a1a;
            border-radius: 20px;
            padding: 32px;
            text-align: center;
            max-width: 360px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-icon {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #4CD964 0%, #30D158 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 32px;
        }

        .modal h2 {
            margin-bottom: 8px;
            font-size: 22px;
        }

        .modal p {
            color: #a1a1a6;
            margin-bottom: 24px;
        }

        .modal button {
            padding: 14px 40px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
        }

        /* Loading Spinner */
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            display: inline-block;
            margin-right: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* VIN Counter */
        .vin-counter {
            font-size: 11px;
            color: #666;
            text-align: right;
            margin-top: 4px;
        }

        .vin-counter.valid {
            color: #4CD964;
        }

        .vin-counter.invalid {
            color: #FF453A;
        }

        /* Photo Upload Styles */
        .photo-upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background: rgba(255, 255, 255, 0.02);
        }

        .photo-upload-area:hover {
            border-color: #4CD964;
            background: rgba(76, 217, 100, 0.05);
        }

        .photo-upload-area.dragover {
            border-color: #4CD964;
            background: rgba(76, 217, 100, 0.1);
        }

        .photo-upload-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .photo-upload-text {
            color: #a1a1a6;
            font-size: 14px;
        }

        .photo-upload-text strong {
            color: #4CD964;
        }

        .photo-buttons {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .photo-btn {
            flex: 1;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: #fff;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s ease;
        }

        .photo-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .photo-btn.camera {
            background: rgba(0, 122, 255, 0.2);
            border-color: #007AFF;
        }

        .photo-btn.camera:hover {
            background: rgba(0, 122, 255, 0.3);
        }

        .photo-previews {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 16px;
        }

        .photo-preview {
            position: relative;
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.05);
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-preview .remove-photo {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 24px;
            height: 24px;
            background: rgba(255, 69, 58, 0.9);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .photo-preview .upload-status {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 4px;
            background: rgba(0, 0, 0, 0.7);
            font-size: 10px;
            text-align: center;
        }

        .photo-preview .upload-status.uploading {
            color: #FF9F0A;
        }

        .photo-preview .upload-status.uploaded {
            color: #4CD964;
        }

        .photo-preview .upload-status.error {
            color: #FF453A;
        }

        .photo-count {
            font-size: 12px;
            color: #a1a1a6;
            margin-top: 8px;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="logo">ðŸš— Dent Experts</div>
            <div class="subtitle">PDR Vehicle Scope & Parts Sheet</div>
            <div class="form-meta">
                <span><strong>RO#:</strong> <input type="text" id="roNumber" class="inline-input" required></span>
                <span><strong>Estimator:</strong> <select id="estimator" class="inline-input">
                        <option value="">Select</option>
                    </select></span>
            </div>
        </div>

        <form id="scopeForm">
            <!-- GENERAL INFORMATION (Compact Grid) -->
            <div class="general-info-grid">
                <div class="info-group">
                    <label>Insured</label>
                    <div class="custom-select-wrapper">
                        <select id="insuranceCompany" required>
                            <option value="">Select Insurance</option>
                        </select>
                    </div>
                </div>
                <div class="info-group">
                    <label>Claim #</label>
                    <input type="text" id="claimNumber" required>
                </div>
                <div class="info-group">
                    <label>Year / Make / Model</label>
                    <div class="ymb-row">
                        <select id="year" style="width: 70px"></select>
                        <select id="make" style="flex:1"></select>
                        <input type="text" id="model" placeholder="Model" style="flex:1">
                    </div>
                </div>
                <div class="info-group">
                    <label>Odometer</label>
                    <input type="text" id="odometer">
                </div>
                <div class="info-group">
                    <label>Location</label>
                    <select id="location"></select>
                </div> <!-- VIN Row -->
                <div class="info-group span-2">
                    <label>VIN # <span id="vinCounter" class="vin-counter">0/17</span></label>
                    <div class="vin-row">
                        <input type="text" id="vin" maxlength="17" oninput="updateVinCounter()">
                        <button type="button" class="scan-btn" onclick="startScanner()">ðŸ“·</button>
                    </div>
                </div>
                <div class="info-group">
                    <label>Color / Trim</label>
                    <input type="text" id="color">
                </div>
            </div>

            <!-- VEHICLE DAMAGE ASSESSMENT (Visual Grid) -->
            <div class="damage-grid-container">
                <div class="grid-header">Vehicle Damage Assessment</div>

                <div class="visual-grid">
                    <!-- LEFT COLUMN -->
                    <div class="side-column">
                        <!-- Left Fender -->
                        <div class="panel-box">
                            <div class="panel-header">Left Fender</div>
                            <div class="panel-ratings">
                                <label>DC: <input type="text" name="lf_fender_dc"></label>
                                <label>OS: <input type="text" name="lf_fender_os"></label>
                            </div>
                            <table class="checklist-table">
                                <tr>
                                    <th>R&I</th>
                                    <th>Part</th>
                                    <th>R&R</th>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lf_fender_ri_lamp"></td>
                                    <td>Lamp(s)</td>
                                    <td><input type="checkbox" name="lf_fender_rr_lamp"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lf_fender_ri_mldg"></td>
                                    <td>Side Mldg</td>
                                    <td><input type="checkbox" name="lf_fender_rr_mldg"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lf_fender_ri_emblem"></td>
                                    <td>Emblem</td>
                                    <td><input type="checkbox" name="lf_fender_rr_emblem"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lf_fender_ri_liner"></td>
                                    <td>Liner/Flare</td>
                                    <td><input type="checkbox" name="lf_fender_rr_liner"></td>
                                </tr>
                            </table>
                        </div>

                        <!-- Left Front Door -->
                        <div class="panel-box">
                            <div class="panel-header">Left Front Door</div>
                            <div class="panel-ratings">
                                <label>DC: <input type="text" name="lf_door_dc"></label>
                                <label>OS: <input type="text" name="lf_door_os"></label>
                            </div>
                            <table class="checklist-table">
                                <tr>
                                    <th>R&I</th>
                                    <th>Part</th>
                                    <th>R&R</th>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lf_door_ri_mirror"></td>
                                    <td>Mirror</td>
                                    <td><input type="checkbox" name="lf_door_rr_mirror"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lf_door_ri_uppermldg"></td>
                                    <td>Upper Mldg</td>
                                    <td><input type="checkbox" name="lf_door_rr_uppermldg"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lf_door_ri_beltmldg"></td>
                                    <td>Belt Mldg</td>
                                    <td><input type="checkbox" name="lf_door_rr_beltmldg"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lf_door_ri_applique"></td>
                                    <td>Applique</td>
                                    <td><input type="checkbox" name="lf_door_rr_applique"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lf_door_ri_trim"></td>
                                    <td>Trim Panel</td>
                                    <td><input type="checkbox" name="lf_door_rr_trim"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lf_door_ri_door"></td>
                                    <td>Door</td>
                                    <td><input type="checkbox" name="lf_door_rr_door"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lf_door_ri_handle"></td>
                                    <td>Handle</td>
                                    <td><input type="checkbox" name="lf_door_rr_handle"></td>
                                </tr>
                            </table>
                        </div>

                        <!-- Left Rear Door -->
                        <div class="panel-box">
                            <div class="panel-header">Left Rear Door</div>
                            <div class="panel-ratings">
                                <label>DC: <input type="text" name="lr_door_dc"></label>
                                <label>OS: <input type="text" name="lr_door_os"></label>
                            </div>
                            <table class="checklist-table">
                                <tr>
                                    <th>R&I</th>
                                    <th>Part</th>
                                    <th>R&R</th>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lr_door_ri_uppermldg"></td>
                                    <td>Upper Mldg</td>
                                    <td><input type="checkbox" name="lr_door_rr_uppermldg"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lr_door_ri_beltmldg"></td>
                                    <td>Belt Mldg</td>
                                    <td><input type="checkbox" name="lr_door_rr_beltmldg"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lr_door_ri_applique"></td>
                                    <td>Applique</td>
                                    <td><input type="checkbox" name="lr_door_rr_applique"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lr_door_ri_trim"></td>
                                    <td>Trim Panel</td>
                                    <td><input type="checkbox" name="lr_door_rr_trim"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lr_door_ri_door"></td>
                                    <td>Door</td>
                                    <td><input type="checkbox" name="lr_door_rr_door"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lr_door_ri_handle"></td>
                                    <td>Handle</td>
                                    <td><input type="checkbox" name="lr_door_rr_handle"></td>
                                </tr>
                            </table>
                        </div>

                        <!-- Left Quarter -->
                        <div class="panel-box">
                            <div class="panel-header">Left Quarter/Bed</div>
                            <div class="panel-ratings">
                                <label>DC: <input type="text" name="lr_quarter_dc"></label>
                                <label>OS: <input type="text" name="lr_quarter_os"></label>
                            </div>
                            <table class="checklist-table">
                                <tr>
                                    <th>R&I</th>
                                    <th>Part</th>
                                    <th>R&R</th>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lr_quarter_ri_lamp"></td>
                                    <td>Lamp(s)</td>
                                    <td><input type="checkbox" name="lr_quarter_rr_lamp"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lr_quarter_ri_mldg"></td>
                                    <td>Side Mldg</td>
                                    <td><input type="checkbox" name="lr_quarter_rr_mldg"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lr_quarter_ri_glass"></td>
                                    <td>Glass</td>
                                    <td><input type="checkbox" name="lr_quarter_rr_glass"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="lr_quarter_ri_liner"></td>
                                    <td>Liner/Flare</td>
                                    <td><input type="checkbox" name="lr_quarter_rr_liner"></td>
                                </tr>
                            </table>
                        </div>

                        <!-- Left Cab Corner (Ratings Only) -->
                        <div class="panel-box mini">
                            <div class="panel-header">Left Cab Corner</div>
                            <div class="panel-ratings">
                                <label>DC: <input type="text" name="l_cab_dc"></label>
                                <label>OS: <input type="text" name="l_cab_os"></label>
                            </div>
                        </div>
                    </div>

                    <!-- CENTER COLUMN (Schematic + Top/Bottom Panels) -->
                    <div class="center-column">
                        <!-- Schematic Visualization (CSS Art or Image Placehoder) -->
                        <!-- Schematic Visualization -->
                        <div class="car-schematic" style="text-align: center; margin-bottom: 20px; opacity: 0.8;">
                            <svg width="200" height="300" viewBox="0 0 200 300" xmlns="http://www.w3.org/2000/svg">
                                <!-- Styles -->
                                <style>
                                    .car-line {
                                        fill: none;
                                        stroke: #4CD964;
                                        stroke-width: 2;
                                    }

                                    .car-fill {
                                        fill: #222;
                                    }

                                    .glass {
                                        fill: #333;
                                        stroke: #4CD964;
                                        stroke-width: 1;
                                    }
                                </style>

                                <!-- Body Outline -->
                                <path class="car-line car-fill"
                                    d="M40,60 C40,40 60,20 100,20 C140,20 160,40 160,60 L160,240 C160,260 140,280 100,280 C60,280 40,260 40,240 Z" />

                                <!-- Windshield -->
                                <path class="glass" d="M45,80 L155,80 L150,110 L50,110 Z" />

                                <!-- Rear Window -->
                                <path class="glass" d="M45,220 L155,220 L150,190 L50,190 Z" />

                                <!-- Roof Lines (Ditches) -->
                                <line x1="45" y1="110" x2="45" y2="190" stroke="#444" stroke-width="1" />
                                <line x1="155" y1="110" x2="155" y2="190" stroke="#444" stroke-width="1" />

                                <!-- Hood -->
                                <text x="100" y="55" fill="#666" font-size="10" text-anchor="middle"
                                    font-family="sans-serif">HOOD</text>

                                <!-- Roof -->
                                <text x="100" y="150" fill="#666" font-size="10" text-anchor="middle"
                                    font-family="sans-serif">ROOF</text>

                                <!-- Decklid/Gate -->
                                <text x="100" y="250" fill="#666" font-size="10" text-anchor="middle"
                                    font-family="sans-serif">TRUNK</text>

                                <!-- Mirrors -->
                                <rect x="25" y="85" width="15" height="10" rx="2" fill="#444" />
                                <rect x="160" y="85" width="15" height="10" rx="2" fill="#444" />
                            </svg>
                        </div>

                        <!-- Hood/Windshield -->
                        <div class="panel-box">
                            <div class="panel-header">Hood / Windshield</div>
                            <div class="panel-ratings">
                                <label>Hood DC: <input type="text" name="hood_dc"></label>
                                <label>Hood OS: <input type="text" name="hood_os"></label>
                            </div>
                            <table class="checklist-table">
                                <tr>
                                    <th>R&I</th>
                                    <th>Part</th>
                                    <th>R&R</th>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="hood_ri_windshield"></td>
                                    <td>Windshield</td>
                                    <td><input type="checkbox" name="hood_rr_windshield"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="hood_ri_cowl"></td>
                                    <td>Cowl</td>
                                    <td><input type="checkbox" name="hood_rr_cowl"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="hood_ri_hood"></td>
                                    <td>Hood</td>
                                    <td><input type="checkbox" name="hood_rr_hood"></td>
                                </tr>
                            </table>
                        </div>

                        <!-- Roof -->
                        <div class="panel-box">
                            <div class="panel-header">Roof</div>
                            <div class="panel-ratings">
                                <label>DC: <input type="text" name="roof_dc"></label>
                                <label>OS: <input type="text" name="roof_os"></label>
                            </div>
                            <table class="checklist-table">
                                <tr>
                                    <th>R&I</th>
                                    <th>Part</th>
                                    <th>R&R</th>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="roof_ri_hilamp"></td>
                                    <td>Hi-Mt Lamp</td>
                                    <td><input type="checkbox" name="roof_rr_hilamp"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="roof_ri_headliner"></td>
                                    <td>Headliner</td>
                                    <td><input type="checkbox" name="roof_rr_headliner"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="roof_ri_sunroof"></td>
                                    <td>Sunroof</td>
                                    <td><input type="checkbox" name="roof_rr_sunroof"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="roof_ri_l_mldg"></td>
                                    <td>L Roof Mldg</td>
                                    <td><input type="checkbox" name="roof_rr_l_mldg"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="roof_ri_r_mldg"></td>
                                    <td>R Roof Mldg</td>
                                    <td><input type="checkbox" name="roof_rr_r_mldg"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="roof_ri_rack"></td>
                                    <td>Roof Rack</td>
                                    <td><input type="checkbox" name="roof_rr_rack"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="roof_ri_ant"></td>
                                    <td>Antenna</td>
                                    <td><input type="checkbox" name="roof_rr_ant"></td>
                                </tr>
                            </table>
                        </div>

                        <!-- Rails -->
                        <div class="rails-row">
                            <div class="panel-box mini">
                                <div class="panel-header">Left Rail</div>
                                <div class="panel-ratings vertical">
                                    <label>DC: <input type="text" name="l_rail_dc"></label>
                                    <label>OS: <input type="text" name="l_rail_os"></label>
                                </div>
                            </div>
                            <div class="panel-box mini">
                                <div class="panel-header">Right Rail</div>
                                <div class="panel-ratings vertical">
                                    <label>DC: <input type="text" name="r_rail_dc"></label>
                                    <label>OS: <input type="text" name="r_rail_os"></label>
                                </div>
                            </div>
                        </div>

                        <!-- Deck/Lid -->
                        <div class="panel-box">
                            <div class="panel-header">Deck / Lid / Gate</div>
                            <div class="panel-ratings">
                                <label>DC: <input type="text" name="deck_dc"></label>
                                <label>OS: <input type="text" name="deck_os"></label>
                            </div>
                            <table class="checklist-table">
                                <tr>
                                    <th>R&I</th>
                                    <th>Part</th>
                                    <th>R&R</th>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="deck_ri_llamp"></td>
                                    <td>L Lamp(s)</td>
                                    <td><input type="checkbox" name="deck_rr_llamp"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="deck_ri_rlamp"></td>
                                    <td>R Lamp(s)</td>
                                    <td><input type="checkbox" name="deck_rr_rlamp"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="deck_ri_handle"></td>
                                    <td>Handle</td>
                                    <td><input type="checkbox" name="deck_rr_handle"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="deck_ri_spoiler"></td>
                                    <td>Spoiler</td>
                                    <td><input type="checkbox" name="deck_rr_spoiler"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="deck_ri_ant"></td>
                                    <td>Antenna</td>
                                    <td><input type="checkbox" name="deck_rr_ant"></td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <!-- RIGHT COLUMN -->
                    <div class="side-column">
                        <!-- Right Fender -->
                        <div class="panel-box">
                            <div class="panel-header">Right Fender</div>
                            <div class="panel-ratings">
                                <label>DC: <input type="text" name="rf_fender_dc"></label>
                                <label>OS: <input type="text" name="rf_fender_os"></label>
                            </div>
                            <table class="checklist-table">
                                <tr>
                                    <th>R&I</th>
                                    <th>Part</th>
                                    <th>R&R</th>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rf_fender_ri_lamp"></td>
                                    <td>Lamp(s)</td>
                                    <td><input type="checkbox" name="rf_fender_rr_lamp"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rf_fender_ri_mldg"></td>
                                    <td>Side Mldg</td>
                                    <td><input type="checkbox" name="rf_fender_rr_mldg"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rf_fender_ri_emblem"></td>
                                    <td>Emblem</td>
                                    <td><input type="checkbox" name="rf_fender_rr_emblem"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rf_fender_ri_liner"></td>
                                    <td>Liner/Flare</td>
                                    <td><input type="checkbox" name="rf_fender_rr_liner"></td>
                                </tr>
                            </table>
                        </div>

                        <!-- Right Front Door -->
                        <div class="panel-box">
                            <div class="panel-header">Right Front Door</div>
                            <div class="panel-ratings">
                                <label>DC: <input type="text" name="rf_door_dc"></label>
                                <label>OS: <input type="text" name="rf_door_os"></label>
                            </div>
                            <table class="checklist-table">
                                <tr>
                                    <th>R&I</th>
                                    <th>Part</th>
                                    <th>R&R</th>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rf_door_ri_mirror"></td>
                                    <td>Mirror</td>
                                    <td><input type="checkbox" name="rf_door_rr_mirror"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rf_door_ri_uppermldg"></td>
                                    <td>Upper Mldg</td>
                                    <td><input type="checkbox" name="rf_door_rr_uppermldg"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rf_door_ri_beltmldg"></td>
                                    <td>Belt Mldg</td>
                                    <td><input type="checkbox" name="rf_door_rr_beltmldg"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rf_door_ri_applique"></td>
                                    <td>Applique</td>
                                    <td><input type="checkbox" name="rf_door_rr_applique"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rf_door_ri_trim"></td>
                                    <td>Trim Panel</td>
                                    <td><input type="checkbox" name="rf_door_rr_trim"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rf_door_ri_door"></td>
                                    <td>Door</td>
                                    <td><input type="checkbox" name="rf_door_rr_door"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rf_door_ri_handle"></td>
                                    <td>Handle</td>
                                    <td><input type="checkbox" name="rf_door_rr_handle"></td>
                                </tr>
                            </table>
                        </div>

                        <!-- Right Rear Door -->
                        <div class="panel-box">
                            <div class="panel-header">Right Rear Door</div>
                            <div class="panel-ratings">
                                <label>DC: <input type="text" name="rr_door_dc"></label>
                                <label>OS: <input type="text" name="rr_door_os"></label>
                            </div>
                            <table class="checklist-table">
                                <tr>
                                    <th>R&I</th>
                                    <th>Part</th>
                                    <th>R&R</th>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rr_door_ri_uppermldg"></td>
                                    <td>Upper Mldg</td>
                                    <td><input type="checkbox" name="rr_door_rr_uppermldg"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rr_door_ri_beltmldg"></td>
                                    <td>Belt Mldg</td>
                                    <td><input type="checkbox" name="rr_door_rr_beltmldg"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rr_door_ri_applique"></td>
                                    <td>Applique</td>
                                    <td><input type="checkbox" name="rr_door_rr_applique"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rr_door_ri_trim"></td>
                                    <td>Trim Panel</td>
                                    <td><input type="checkbox" name="rr_door_rr_trim"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rr_door_ri_door"></td>
                                    <td>Door</td>
                                    <td><input type="checkbox" name="rr_door_rr_door"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rr_door_ri_handle"></td>
                                    <td>Handle</td>
                                    <td><input type="checkbox" name="rr_door_rr_handle"></td>
                                </tr>
                            </table>
                        </div>

                        <!-- Right Quarter -->
                        <div class="panel-box">
                            <div class="panel-header">Right Quarter/Bed</div>
                            <div class="panel-ratings">
                                <label>DC: <input type="text" name="rr_quarter_dc"></label>
                                <label>OS: <input type="text" name="rr_quarter_os"></label>
                            </div>
                            <table class="checklist-table">
                                <tr>
                                    <th>R&I</th>
                                    <th>Part</th>
                                    <th>R&R</th>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rr_quarter_ri_lamp"></td>
                                    <td>Lamp(s)</td>
                                    <td><input type="checkbox" name="rr_quarter_rr_lamp"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rr_quarter_ri_mldg"></td>
                                    <td>Side Mldg</td>
                                    <td><input type="checkbox" name="rr_quarter_rr_mldg"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rr_quarter_ri_glass"></td>
                                    <td>Glass</td>
                                    <td><input type="checkbox" name="rr_quarter_rr_glass"></td>
                                </tr>
                                <tr>
                                    <td><input type="checkbox" name="rr_quarter_ri_liner"></td>
                                    <td>Liner/Flare</td>
                                    <td><input type="checkbox" name="rr_quarter_rr_liner"></td>
                                </tr>
                            </table>
                        </div>

                        <!-- Right Cab Corner (Ratings Only) -->
                        <div class="panel-box mini">
                            <div class="panel-header">Right Cab Corner</div>
                            <div class="panel-ratings">
                                <label>DC: <input type="text" name="r_cab_dc"></label>
                                <label>OS: <input type="text" name="r_cab_os"></label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PHOTOS ONLY (Reduced notes etc to match photo priority, kept Notes though) -->
            <div class="section footer-section">
                <!-- Notes -->
                <div class="notes-box">
                    <label>Notes:</label>
                    <textarea id="notes" rows="4"></textarea>
                </div>

                <!-- Photos -->
                <div class="photo-section">
                    <label>Photos (Vin/Odometer/Damage):</label>
                    <div class="photo-controls">
                        <button type="button" class="photo-btn camera" onclick="openCamera()">ðŸ“· Camera</button>
                        <button type="button" class="photo-btn"
                            onclick="document.getElementById('photoInput').click()">ðŸ–¼ï¸ Gallery</button>
                    </div>
                    <input type="file" id="photoInput" accept="image/*" multiple style="display: none"
                        onchange="handlePhotoSelect(event)">
                    <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display: none"
                        onchange="handlePhotoSelect(event)">
                    <div id="photoPreviews" class="photo-previews-row"></div>
                </div>
            </div>

            <div class="submit-bar">
                <div class="status-select">
                    <label>Status:</label>
                    <select id="status" required>
                        <option value="Complete">Complete</option>
                        <option value="Partial">Partial</option>
                        <option value="Supplement">Supplement</option>
                    </select>
                </div>
                <button type="submit" id="submitBtn" onclick="submitForm()">Submit Scope</button>
            </div>
        </form>
    </div>

    <!-- Modal and Scripts -->
    <div class="modal-overlay" id="successModal">
        <div class="modal">
            <div class="modal-icon">âœ“</div>
            <h2>Scope Submitted!</h2>
            <button onclick="resetForm()">New Scope</button>
        </div>
    </div>

    <!-- Retaining Scripts & Styles block (will update CSS next tool call) -->
    <style>
        /* BASE & RESET */
        * {
            box-sizing: border-box;
        }

        body {
            background: #1e1e1e;
            color: #ccc;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        /* GRID LAYOUTS */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 10px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #2d2d2d;
            padding: 10px 20px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .header .logo {
            font-size: 20px;
            font-weight: bold;
            color: #4CD964;
        }

        .form-meta {
            display: flex;
            gap: 20px;
        }

        .inline-input {
            background: #111;
            border: 1px solid #444;
            color: #fff;
            padding: 5px;
            border-radius: 4px;
        }

        /* GENERAL INFO GRID */
        .general-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            background: #252525;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .info-group label {
            display: block;
            font-size: 11px;
            color: #888;
            margin-bottom: 4px;
        }

        .info-group input,
        .info-group select {
            width: 100%;
            background: #111;
            border: 1px solid #333;
            color: #fff;
            padding: 8px;
            border-radius: 4px;
        }

        .vin-row {
            display: flex;
            gap: 5px;
        }

        /* DAMAGE GRID */
        .damage-grid-container {
            background: #252525;
            padding: 15px;
            border-radius: 8px;
        }

        .grid-header {
            background: #333;
            color: #fff;
            padding: 8px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 15px;
            border-radius: 4px;
        }

        .visual-grid {
            display: grid;
            grid-template-columns: 320px 1fr 320px;
            /* Fixed side columns, flexible center */
            gap: 20px;
        }

        @media (max-width: 1024px) {
            .visual-grid {
                grid-template-columns: 1fr 1fr;
            }

            .center-column {
                grid-column: 1 / -1;
                order: -1;
            }

            /* Center moves to top on tablet */
        }

        @media (max-width: 768px) {
            .visual-grid {
                grid-template-columns: 1fr;
            }
        }

        /* PANEL BOXES */
        .panel-box {
            background: #303030;
            border: 1px solid #444;
            margin-bottom: 15px;
            border-radius: 6px;
            overflow: hidden;
        }

        .panel-header {
            background: linear-gradient(90deg, #3a3a3a, #2a2a2a);
            border-left: 3px solid #4CD964;
            color: #fff;
            font-size: 12px;
            font-weight: 700;
            padding: 8px 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-ratings {
            display: flex;
            gap: 10px;
            padding: 8px;
            background: #383838;
        }

        .panel-ratings label {
            font-size: 12px;
            color: #aaa;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .panel-ratings input {
            width: 50px;
            background: #222;
            border: 1px solid #555;
            color: #4CD964;
            padding: 4px;
            text-align: center;
            font-weight: bold;
        }

        /* CHECKLIST TABLES */
        .checklist-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .checklist-table th {
            background: #222;
            color: #888;
            padding: 4px;
            font-weight: normal;
            font-size: 10px;
        }

        .checklist-table td {
            padding: 6px 4px;
            border-bottom: 1px solid #3a3a3a;
            text-align: center;
        }

        .checklist-table td:nth-child(2) {
            text-align: left;
            width: 60%;
        }

        /* Custom Checkbox */
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #4CD964;
            cursor: pointer;
        }

        /* FOOTER */
        .footer-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .notes-box textarea {
            width: 100%;
            background: #222;
            border: 1px solid #444;
            color: #fff;
            padding: 10px;
        }

        .submit-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(30, 30, 30, 0.95);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid #444;
        }

        #submitBtn {
            background: #4CD964;
            color: #000;
            border: none;
            padding: 12px 40px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
        }
    </style>

    <script>
        // CONFIGURATION
        const CONFIG = {
            photoFolderId: 'YOUR_FOLDER_ID_HERE'
        };

        // STATE
        let selectedPhotos = [];

        // INITIALIZATION
        document.addEventListener('DOMContentLoaded', () => {
            loadDropdowns();
            // Set date defaults if needed
        });

        function loadDropdowns() {
            // Populate Year
            const yearSelect = document.getElementById('year');
            const currentYear = new Date().getFullYear();
            for (let i = currentYear + 1; i >= 1990; i--) {
                const opt = document.createElement('option');
                opt.value = i;
                opt.text = i;
                yearSelect.add(opt);
            }
            // Populate basic Makes (can expand later)
            const makes = ["Ford", "Chevy", "Dodge/Ram", "Toyota", "Honda", "Nissan", "Hyundai/Kia", "BMW", "Mercedes", "Audi", "VW", "Tesla", "Subaru", "Other"];
            const makeSelect = document.getElementById('make');
            makes.forEach(m => {
                const opt = document.createElement('option');
                opt.value = m;
                opt.text = m;
                makeSelect.add(opt);
            });
            // Locations
            const locs = ["Shop", "Mobile", "Dealership", "Auction"];
            const locSelect = document.getElementById('location');
            locs.forEach(l => {
                const opt = document.createElement('option');
                opt.value = l;
                opt.text = l;
                locSelect.add(opt);
            });
            // Insurance
            const ins = ["State Farm", "Geico", "Progressive", "Allstate", "Liberty Mutual", "Farmers", "Nationwide", "USAA", "Other"];
            const insSelect = document.getElementById('insuranceCompany');
            ins.forEach(i => {
                const opt = document.createElement('option');
                opt.value = i;
                opt.text = i;
                insSelect.add(opt);
            });
        }

        // --- VIN LOGIC ---
        function updateVinCounter() {
            const vin = document.getElementById('vin').value;
            document.getElementById('vinCounter').textContent = `${vin.length}/17`;
        }

        // --- PHOTO LOGIC ---
        function openCamera() {
            document.getElementById('cameraInput').click();
        }

        function handlePhotoSelect(event) {
            const files = Array.from(event.target.files);
            if (files.length === 0) return;

            files.forEach(file => {
                compressImage(file, (compressedBase64, mimeType) => {
                    selectedPhotos.push({
                        base64Data: compressedBase64,
                        mimeType: mimeType,
                        name: file.name
                    });
                    renderPreviews();
                });
            });
            event.target.value = ''; // Reset input
        }

        function renderPreviews() {
            const container = document.getElementById('photoPreviews');
            container.innerHTML = '';
            selectedPhotos.forEach((photo, idx) => {
                const div = document.createElement('div');
                div.className = 'photo-preview';
                div.style.cssText = `
                    width: 60px; height: 60px; position: relative; border-radius: 4px; overflow: hidden; border: 1px solid #444; background: #000;
                    display: inline-block; margin-right: 5px;
                `;
                div.innerHTML = `
                    <img src="data:${photo.mimeType};base64,${photo.base64Data}" style="width:100%; height:100%; object-fit:cover;">
                    <button onclick="removePhoto(${idx})" style="
                        position: absolute; top: 0; right: 0; background: rgba(0,0,0,0.7); color: #fff; border: none; width: 20px; height: 20px; cursor: pointer; font-size: 14px; line-height: 1;
                    ">Ã—</button>
                `;
                container.appendChild(div);
            });
            // Update Text?
        }

        function removePhoto(index) {
            selectedPhotos.splice(index, 1);
            renderPreviews();
        }

        function compressImage(file, callback) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;
                    const MAX_SIZE = 1200;
                    if (width > height) {
                        if (width > MAX_SIZE) { height *= MAX_SIZE / width; width = MAX_SIZE; }
                    } else {
                        if (height > MAX_SIZE) { width *= MAX_SIZE / height; height = MAX_SIZE; }
                    }
                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    const dataUrl = canvas.toDataURL('image/jpeg', 0.7);
                    callback(dataUrl.split(',')[1], 'image/jpeg');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // --- SUBMISSION LOGIC ---
        function submitForm() {
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.textContent = 'Processing...';
            submitBtn.disabled = true;

            // Validate Basics
            const roNumber = document.getElementById('roNumber').value;
            if (!roNumber) {
                alert('RO Number is required');
                submitBtn.textContent = 'Submit Scope'; submitBtn.disabled = false;
                return;
            }

            // Photos
            if (selectedPhotos.length > 0) {
                google.script.run
                    .withSuccessHandler((photoUrls) => {
                        // photoUrls is an array of strings
                        submitData(photoUrls);
                    })
                    .withFailureHandler(err => {
                        alert('Photo upload failed: ' + err);
                        submitBtn.textContent = 'Submit Scope'; submitBtn.disabled = false;
                    })
                    .uploadMultiplePhotos(selectedPhotos, roNumber);
            } else {
                // Return empty array if no photos
                submitData([]);
            }
        }

        // 2. Submit Data Function
        function submitData(photoUrls) {
            const submitBtn = document.getElementById('submitBtn'); // Get button reference here
            // updateStatus('Saving data...'); // Assuming updateStatus is defined elsewhere or removed

            // Base Data
            const rawData = {
                roNumber: document.getElementById('roNumber').value,
                vin: document.getElementById('vin').value.toUpperCase(),
                year: document.getElementById('year').value,
                make: document.getElementById('make').value,
                model: document.getElementById('model').value,
                color: document.getElementById('color').value,
                insurance: document.getElementById('insuranceCompany').value, // Corrected ID
                claimNumber: document.getElementById('claimNumber').value,
                location: document.getElementById('location').value,
                // scoper: document.getElementById('scoper').value, // Not in original form
                estimator: document.getElementById('estimator').value,
                // severity: severityRadio.value, // Not in original form
                // panelCount: document.getElementById('panelCount').value, // Not in original form
                notes: document.getElementById('notes').value,
                status: document.getElementById('status').value,
                photoUrls: photoUrls
            };

            // Collect and Bundle Panel Data
            const checklistBundles = {}; // { 'lf_fender_ri': ['Lamp', 'Liner'] }

            // Scan all inputs with names
            document.querySelectorAll('#scopeForm [name]').forEach(input => {
                const name = input.name;
                let value = input.value;

                if (input.type === 'checkbox') {
                    if (!input.checked) return; // Skip unchecked
                    value = 'Yes';

                    // Check for R&I / R&R Pattern: {panel}_{ri|rr}_{part}
                    // Regex: matches anything ending in _ri_{part} or _rr_{part}
                    // We want to capture the panel name and the type.
                    const match = name.match(/^(.+)_(ri|rr)_(.+)$/);
                    if (match) {
                        const panel = match[1];
                        const type = match[2]; // ri or rr
                        const part = match[3];
                        // Create bundle key: lf_fender_ri
                        const bundleKey = `${panel}_${type}`;

                        if (!checklistBundles[bundleKey]) checklistBundles[bundleKey] = [];
                        // Add part name (Capitalized)
                        checklistBundles[bundleKey].push(part.charAt(0).toUpperCase() + part.slice(1));
                        return; // handled
                    }

                    // Other checkboxes (General flags?)
                    rawData[name] = 'Yes';
                } else if (input.type === 'radio') {
                    if (input.checked) rawData[name] = value;
                } else {
                    // Text/Number inputs
                    rawData[name] = value;
                }
            });

            // Merge Bundles into Raw Data
            Object.keys(checklistBundles).forEach(key => {
                rawData[key] = checklistBundles[key].join(', ');
            });

            // Submit to Apps Script
            google.script.run
                .withSuccessHandler(function (result) {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = 'Submit Scope';

                    // Assuming 'result' from Apps Script indicates success/failure
                    if (result && result.success) {
                        document.getElementById('successModal').style.display = 'flex'; // Use style.display for visibility
                    } else {
                        alert('Error: ' + (result ? (result.error || 'Unknown error') : 'Unknown error from server'));
                    }
                })
                .withFailureHandler(function (error) {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = 'Submit Scope';
                    alert('Error submitting form: ' + error.message);
                })
                .saveToSheet(rawData);
        }

        function resetForm() {
            document.getElementById('scopeForm').reset();
            selectedPhotos = [];
            renderPreviews();
            document.getElementById('successModal').style.display = 'none';
        }

        function startScanner() {
            alert('VIN Scanner would open here (Requires HTTPS/Library)');
        }
    </script>
</body>

</html>